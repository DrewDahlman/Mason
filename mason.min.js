!function(e){e.fn.mason=function(t,r){var o={itemSelector:null,ratio:0,sizes:[],columns:[[0,480,1],[480,780,2],[780,1080,3],[1080,1320,4],[1320,1680,5]],promoted:[],filler:{itemSelector:t.itemSelector,filler_class:"mason_filler"},layout:"none",gutter:0};if(r)var l={complete:r};var i={block:{height:0,width:0},matrix:[]};return this.each(function(){function a(){m.children(".mason_clear").length<1&&m.append("<div class='mason_clear' style='clear:both;position:relative;'></div>"),i.block.height=parseFloat((m.width()/n()/h.ratio).toFixed(0)),i.block.width=parseFloat(m.width()/n()),s()}function s(){var t=n();if(1==t)$sel=m.children(h.itemSelector),$sel.height(i.block.height),$sel.width(i.block.width),$sel.css({margin:"0px"});else{for(var r=0;r<h.promoted.length;r++)h.sizes.push([h.promoted[r][0],h.promoted[r][1]]);m.children(h.itemSelector).each(function(){$sel=e(this),s=Math.floor(Math.random()*(h.sizes.length-h.promoted.length)),ranSize=h.sizes[s];for(var t=0;t<h.promoted.length;t++)$sel.hasClass(h.promoted[t][2])&&(ranSize=[h.promoted[t][0],h.promoted[t][1]],s=h.sizes.length-h.promoted.length+t);$sel.data("size",s);var r=parseFloat((i.block.height*ranSize[1]).toFixed(2));r-=2*h.gutter;var o=parseFloat(i.block.width*ranSize[0]);o-=2*h.gutter,$sel.height(r+"px"),$sel.width(o+"px"),$sel.css({margin:h.gutter})});var o=m.height(),l=o/i.block.height;i.matrix=[];for(var r=0;l>r;r++){i.matrix[r]=[];for(var a=0;t>a;a++)i.matrix[r][a]=!1}m.children(h.itemSelector).each(function(){$sel=e(this);for(var t=Math.round($sel.position().left/i.block.width),r=Math.round($sel.position().top/i.block.height),o=parseFloat($sel.data("size")),l=h.sizes[o][1],a=h.sizes[o][0],s=0;l>s;s++)for(var n=0;a>n;n++)i.matrix[r+s][t+n]=!0});for(var r=0;r<i.matrix.length;r++)for(var a=0;a<i.matrix[r].length;a++)if(0==i.matrix[r][a]){var s,d,f=parseFloat(i.block.height),u=parseFloat(i.block.width),p=parseFloat((r*f).toFixed(2))+h.gutter,g=parseFloat(a*u)+h.gutter;f-=2*h.gutter,u-=2*h.gutter,s=Math.floor(Math.random()*e(h.filler.itemSelector).length),d=e(h.filler.itemSelector).eq(s).clone(),d.addClass(h.filler.filler_class),d.css({position:"absolute",top:p+"px",left:g+"px",height:f+"px",width:u+"px",margin:"0px"}),d.appendTo(m)}null!=c.complete&&c.complete()}}function n(){var e=Math.floor(m.width()),t=0,r=h.columns.length-1;if(e>=h.columns[r][1])t=h.columns[r][2];else for(var o=0;r>=o;o++)e>h.columns[o][0]&&e<h.columns[o][1]&&(t=h.columns[o][2]);return t}var h,c,m;h=e.extend(o,t),c=e.extend(l,r),m=e(this);var d=function(){var e={};return function(t,r,o){o||(o=f()),e[o]&&clearTimeout(e[o]),e[o]=setTimeout(t,r)}}(),f=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;5>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e};"fluid"==h.layout&&e(window).resize(function(){e("."+h.filler.filler_class).remove(),i.matrix=[],d(function(){e("."+h.filler.filler_class).remove(),a()},150)}),a()})}}(jQuery);